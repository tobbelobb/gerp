#!/bin/bash

# -I     Process a binary file as if it did not contain matching data
# Sets temporary colors so that awk can match with an reasonably unabigous and fast regex

GREP_COLORS="sl=:cx=:fn=35:ln=32:bn=32:se=36" grep -rn -I --color=always --exclude=cscope.out --exclude=tags "$@" |
  awk '{
         line=$0;
         ORS="";
         if (line ~/\033\[m\033\[K\033\[36m\033\[K:\033\[m\033\[K\033\[32m\033\[K[0-9]+\033\[m\033\[K\033\[36m\033\[K:/)
         {
           n=split(line, a, ":");
           print("vim " a[1] " +" a[2] " ;# ");
           print(a[3]);
           for(i=4;i<n+1;i++){
             print(":" a[i])
           }
           print("\n");
         }
         else if (line ~/\033\[m\033\[K\033\[36m\033\[K-\033\[m\033\[K\033\[32m\033\[K[0-9]+\033\[m\033\[K\033\[36m\033\[K-/)
         {
             n=split(line, a, "-");
             print("vim " a[1] " +" a[2] " ;# ");
             print(a[3]);
             for(i=4;i<n+1;i++){
               print("-" a[i])
             }
             print("\n");
         }
         else
         {
             print(line "\n");
         };
       }';
